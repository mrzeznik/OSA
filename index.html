<!DOCTYPE html>
<html>

<head>
  <title>OSA</title>
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <style>
    body {
      font-family: Consolas, "Courier New", monospace;
    }

    input,
    textarea {
      border: 2px solid;
      border-radius: 4px;
    }

    .container {
      min-height: 10em;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>OSA</h1>
    <h4>Osobisty System Atencji</h4>
    <label for="notificationText">Text:</label><br>
    <textarea id="notificationText" name="notificationText" rows="12" cols="50"
      placeholder="Your notification text..."></textarea><br><br>
    <label for="interval">Interval (min):</label>
    <input type="number" id="interval" name="interval" min="1" max="10080" value="1" maxlength="5" size="6"><br><br>
    <input type="submit" onclick="startNotificatons();" value="Run">
  </div>
  <script>
    const notificationTitle = 'OSA';
    const baseMinuteMultiplier = 1000 * 60;
    const notificationElement = document.getElementById('notificationText');
    const intervalElement = document.getElementById('interval');
    var timers = [];

    function startNotificatons() {
      Notification.requestPermission().then(function (permission) {
        console.log('Notification permission: ' + permission);
      });

      if (timers !== undefined && timers?.length > 0) {
        timers.forEach(timerId => {
          console.log('Removing existing notification timer #' + timerId);
          clearInterval(timerId);
        });
      }
      let interval = baseMinuteMultiplier * intervalElement.value;
      let bodyBase = notificationElement.value.split('\n').filter(function (line) { return line !== undefined & line?.length > 0; });
      let notificationCount = bodyBase.length;

      bodyBase.forEach((singleNotification, number) => {
        let notificationDelay = number * baseMinuteMultiplier;
        let notificationInterval = interval * notificationCount;
        console.info('Add OSA notification #' + parseInt(number + 1) + ' with body: "' + singleNotification + '", every: ' + notificationInterval / baseMinuteMultiplier + ' minute(s), with additional delay: ' + notificationDelay / baseMinuteMultiplier + ' minute(s)');

        setTimeout(function () {
          var timer = setInterval(notify, notificationInterval, notificationTitle, singleNotification);
          timers.push(timer);
        }, notificationDelay);

      });
    }

    function notify(title, body) {
      var notification = new Notification(title, { body });
    }
  </script>
</body>

</html>